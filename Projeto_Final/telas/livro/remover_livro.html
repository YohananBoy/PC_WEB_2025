<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <title>Biblioteca CEFET-RJ</title>
    <link rel="stylesheet" href="../../css/estilo.css" />
  </head>
  <body>
    <div class="container">
      <h1>Biblioteca do CEFET-RJ Nova Friburgo</h1>

      <div id="saida"></div>
    </div>
    <script>
      //Código escrito por Yohanan
      const saida = document.querySelector("#saida")
      /**
       * Função que envia o objeto livro para o servidor
       * de acordo com o método desejado
       */
      async function enviaLivroServidor(livro, metodo) {
        const resposta = await fetch(
          "http://localhost/Projeto_Final_Back/index.php?modulo=livro",
          {
            method: metodo,
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(livro),
          }
        )

        const dados = await resposta.json()
        return dados
      }

      /**
       * Função que busca na API o livro com o mesmo ID que o parâmetro
       */
      async function pegaLivroPorId(id) {
        const resposta = await fetch(
          "http://localhost/Projeto_Final_Back/index.php?modulo=livro"
        )
        const livros = await resposta.json()
        const livro = livros.find((l) => l.id == id)

        if (!livro) {
          alert("Livro não encontrado!")
          return
        }

        return livro
      }

      /**
       * Objeto que o chat gpt me ensinou a usar pra pegar os parametros
       * passados pela URL
       */
      const urlParams = new URLSearchParams(window.location.search)
      const id = urlParams.get("id")

      async function removerLivro() {
        const resposta = await enviaLivroServidor({ id }, "DELETE")
        saida.textContent = resposta.mensagem
      }

      removerLivro()
    </script>
  </body>
</html>
