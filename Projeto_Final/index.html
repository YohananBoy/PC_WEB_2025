<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <title>Biblioteca CEFET-RJ</title>
    <link rel="stylesheet" href="./css/estilo.css" />
  </head>
  <body>
    <div class="container">
      <h1>Biblioteca do CEFET-RJ Nova Friburgo</h1>
      <p id="pInfo"></p>
      <button id="btnLogout">Sair</button>

      <section class="acoes">
        <div>
          <h2>Livro</h2>
          <ul>
            <li><a href="telas/livro/cadastrar_livro.html">Cadastrar</a></li>
            <li><a href="telas/livro/listar_livro.html">Listar</a></li>
            <li>
              <a href="telas/livro/retirada_livro.html">Registrar Retirada</a>
            </li>
          </ul>
        </div>
        <div>
          <h2>Usuário</h2>
          <ul>
            <li>
              <a href="telas/usuario/cadastrar_usuario.html">Cadastrar</a>
            </li>
            <li><a href="telas/usuario/listar_usuario.html">Listar</a></li>
          </ul>
        </div>
      </section>
    </div>
    <script>
      //Código escrito por Yohanan
      let btnLogout = document.getElementById("btnLogout")
      let pInfo = document.getElementById("pInfo")
      async function verificarLogin() {
        const resposta = await fetch(
          "http://localhost/Projeto_Final_Back/index.php?modulo=usuario&acao=verificar",
          { credentials: "include" }
        )
        return await resposta.json()
      }

      async function pegaCredenciais() {
        let dados = await verificarLogin()
        pInfo.textContent = `Bem vindo(a) ${dados.nome} (${dados.email})`
        if (dados.logado !== true) {
          window.location.href = "./telas/login.html"
        }
      }

      async function logout() {
        await fetch(
          "http://localhost/Projeto_Final_Back/index.php?modulo=usuario&acao=logout"
        )
        window.location.href = "telas/login.html"
      }

      pegaCredenciais()

      btnLogout.addEventListener("click", logout)
    </script>
  </body>
</html>
